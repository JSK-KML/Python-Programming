<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Python Editor - Fullscreen</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      background: #0d1117;
      color: white;
      height: 100vh;
      overflow: hidden;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Light mode styles */
    body.light-mode {
      background: #ffffff;
      color: #24292f;
    }

    body.light-mode .fullscreen-container {
      background: #ffffff;
    }

    body.light-mode .header {
      background: #f6f8fa;
      border-bottom-color: #d0d7de;
    }

    body.light-mode .header h1 {
      color: #24292f;
    }

    body.light-mode .controls {
      background: #f6f8fa;
      border-top-color: #d0d7de;
    }

    body.light-mode .output-section {
      background: #f6f8fa;
      border-top-color: #d0d7de;
    }

    body.light-mode .output-header {
      background: #ffffff;
      border-bottom-color: #d0d7de;
      color: #0969da;
    }

    body.light-mode .output-content {
      color: #0969da;
      background: rgba(13, 17, 23, 0.05);
    }

    body.light-mode .resize-handle::before {
      background: #d0d7de;
    }

    body.light-mode .resize-handle:hover::before {
      background: #0969da;
    }

    body.light-mode .output-content::-webkit-scrollbar-track {
      background: #f6f8fa;
    }

    body.light-mode .output-content::-webkit-scrollbar-thumb {
      background: #d0d7de;
    }

    body.light-mode .output-content::-webkit-scrollbar-thumb:hover {
      background: #afb8c1;
    }

    .fullscreen-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      background: #0d1117;
    }

    .header {
      background: #21262d;
      padding: 12px 20px;
      border-bottom: 1px solid #30363d;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .header h1 {
      font-size: 18px;
      font-weight: 600;
      color: #f0f6fc;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-buttons {
      display: flex;
      gap: 80px;
      align-items: center;
    }

    .font-controls {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .editor-font-controls {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .output-font-controls {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .output-font-controls .font-control-btn {
      padding: 4px 8px;
      font-size: 10px;
      font-weight: 600;
      min-width: 24px;
      height: 24px;
    }

    .output-font-controls .font-size-display {
      font-size: 10px;
      min-width: 28px;
    }

    .font-label {
      font-size: 11px;
      font-weight: 600;
      color: #8b949e;
      margin-right: 4px;
    }

    body.light-mode .font-label {
      color: #656d76;
    }

    .program-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .settings-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .font-control-btn {
      padding: 6px 12px;
      background: var(--btn-neutral-bg);
      border: 1px solid var(--btn-neutral-border);
      border-radius: 4px;
      color: #1e293b;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 32px;
      height: 32px;
    }

    .font-control-btn:hover {
      background: var(--btn-neutral-hover);
      border-color: var(--btn-neutral-border-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      color: #0f172a;
    }

    /* Dark mode for font control buttons */
    body:not(.light-mode) .font-control-btn {
      color: white;
    }

    body:not(.light-mode) .font-control-btn:hover {
      color: white;
    }

    .font-size-display {
      color: #8b949e;
      font-size: 12px;
      font-weight: 500;
      margin: 0 4px;
      min-width: 32px;
      text-align: center;
    }

    .theme-toggle {
      padding: 8px 16px;
      background: var(--btn-secondary-bg);
      border: 1px solid var(--btn-secondary-border);
      border-radius: 6px;
      color: #1e293b;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-right: 12px;
    }

    .theme-toggle:hover {
      background: var(--btn-secondary-hover);
      border-color: var(--btn-secondary-border-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      color: #0f172a;
    }

    /* Dark mode for theme toggle */
    body:not(.light-mode) .theme-toggle {
      color: white;
    }

    body:not(.light-mode) .theme-toggle:hover {
      color: white;
    }

    .main-content {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    .editor-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      min-width: 0;
    }

    .editor-wrapper {
      flex: 1;
      background: #0d1117;
      position: relative;
      min-height: 0;
    }

    #monaco-editor {
      height: 100%;
      width: 100%;
    }

    .controls {
      background: #21262d;
      padding: 16px 20px;
      border-top: 1px solid #30363d;
      display: flex;
      gap: 12px;
      flex-shrink: 0;
    }

    .output-section {
      background: #161b22;
      border-top: 1px solid #30363d;
      height: 200px;
      min-height: 100px;
      max-height: 70vh;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .resize-handle {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: transparent;
      cursor: ns-resize;
      z-index: 100;
      transition: background 0.2s ease;
    }

    .resize-handle:hover {
      background: rgba(59, 130, 246, 0.3);
    }

    .resize-handle::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 2px;
      background: #30363d;
      border-radius: 1px;
    }

    .resize-handle:hover::before {
      background: #3b82f6;
    }

    .resizing {
      user-select: none;
    }

    .resizing .output-section {
      transition: none;
    }

    .output-header {
      background: #21262d;
      padding: 12px 20px;
      border-bottom: 1px solid #30363d;
      font-weight: 600;
      font-size: 14px;
      color: #3b82f6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .output-content {
      flex: 1;
      padding: 16px 20px;
      overflow-y: auto;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      color: #58a6ff;
      white-space: pre-wrap;
    }

    /* CSS Variables for Button System */
    :root {
      /* Gradient color scheme variables */
      --gradient-subtle: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
      --gradient-light: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 51, 234, 0.15) 100%);
      --gradient-primary: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(147, 51, 234, 0.2) 100%);
      --gradient-medium: linear-gradient(135deg, rgba(59, 130, 246, 0.25) 0%, rgba(147, 51, 234, 0.25) 100%);
      --gradient-hover: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(147, 51, 234, 0.3) 100%);
      --gradient-strong: linear-gradient(135deg, rgba(59, 130, 246, 0.35) 0%, rgba(147, 51, 234, 0.35) 100%);
      --gradient-active: linear-gradient(135deg, rgba(59, 130, 246, 0.4) 0%, rgba(147, 51, 234, 0.4) 100%);
      
      /* Gradient border colors */
      --gradient-border-light: rgba(59, 130, 246, 0.2);
      --gradient-border-medium: rgba(59, 130, 246, 0.3);
      --gradient-border-strong: rgba(59, 130, 246, 0.4);
      --gradient-border-active: rgba(59, 130, 246, 0.6);

      /* Standardized Button Color System */
      --btn-primary-bg: var(--gradient-hover);
      --btn-primary-hover: var(--gradient-active);
      --btn-primary-border: var(--gradient-border-medium);
      --btn-primary-border-hover: var(--gradient-border-active);

      --btn-secondary-bg: var(--gradient-primary);
      --btn-secondary-hover: var(--gradient-hover);
      --btn-secondary-border: var(--gradient-border-light);
      --btn-secondary-border-hover: var(--gradient-border-medium);

      --btn-neutral-bg: var(--gradient-subtle);
      --btn-neutral-hover: var(--gradient-primary);
      --btn-neutral-border: var(--gradient-border-light);
      --btn-neutral-border-hover: var(--gradient-border-medium);

      --btn-warning-bg: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
      --btn-warning-hover: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(217, 119, 6, 0.3) 100%);
      --btn-warning-border: rgba(245, 158, 11, 0.3);
      --btn-warning-border-hover: rgba(245, 158, 11, 0.5);

      --btn-danger-bg: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(185, 28, 28, 0.2) 100%);
      --btn-danger-hover: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(185, 28, 28, 0.3) 100%);
      --btn-danger-border: rgba(239, 68, 68, 0.3);
      --btn-danger-border-hover: rgba(239, 68, 68, 0.5);
    }

    /* Button Styles */
    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      height: 32px;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--btn-primary-bg);
      color: #1e293b; /* Dark text for light mode */
      border: 1px solid var(--btn-primary-border);
    }

    .btn-primary:hover {
      background: var(--btn-primary-hover);
      border-color: var(--btn-primary-border-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      color: #0f172a; /* Darker text on hover */
    }

    .btn-secondary {
      background: var(--btn-secondary-bg);
      color: #1e293b; /* Dark text for light mode */
      border: 1px solid var(--btn-secondary-border);
    }

    .btn-secondary:hover {
      background: var(--btn-secondary-hover);
      border-color: var(--btn-secondary-border-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      color: #0f172a; /* Darker text on hover */
    }

    .btn-neutral {
      background: var(--btn-neutral-bg);
      color: #1e293b; /* Dark text for light mode */
      border: 1px solid var(--btn-neutral-border);
    }

    .btn-neutral:hover {
      background: var(--btn-neutral-hover);
      border-color: var(--btn-neutral-border-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      color: #0f172a; /* Darker text on hover */
    }

    .btn-warning {
      background: var(--btn-warning-bg);
      color: #78350f; /* Amber dark text for warning buttons */
      border: 1px solid var(--btn-warning-border);
    }

    .btn-warning:hover {
      background: var(--btn-warning-hover);
      border-color: var(--btn-warning-border-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      color: #451a03; /* Darker amber text on hover */
    }

    .btn-danger {
      background: var(--btn-danger-bg);
      color: #7f1d1d; /* Red dark text for danger buttons */
      border: 1px solid var(--btn-danger-border);
    }

    .btn-danger:hover {
      background: var(--btn-danger-hover);
      border-color: var(--btn-danger-border-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      color: #450a0a; /* Darker red text on hover */
    }

    /* Dark Mode Button Styles */
    body:not(.light-mode) .btn-primary {
      color: white; /* White text for dark mode */
    }

    body:not(.light-mode) .btn-primary:hover {
      color: white;
    }

    body:not(.light-mode) .btn-secondary {
      color: white;
    }

    body:not(.light-mode) .btn-secondary:hover {
      color: white;
    }

    body:not(.light-mode) .btn-neutral {
      color: white;
    }

    body:not(.light-mode) .btn-neutral:hover {
      color: white;
    }

    body:not(.light-mode) .btn-warning {
      color: white; /* White text for better contrast in dark mode */
    }

    body:not(.light-mode) .btn-warning:hover {
      color: white;
    }

    body:not(.light-mode) .btn-danger {
      color: white; /* White text for better contrast in dark mode */
    }

    body:not(.light-mode) .btn-danger:hover {
      color: white;
    }

    /* Scrollbar */
    .output-content::-webkit-scrollbar {
      width: 8px;
    }

    .output-content::-webkit-scrollbar-track {
      background: #21262d;
    }

    .output-content::-webkit-scrollbar-thumb {
      background: #30363d;
      border-radius: 4px;
    }

    .output-content::-webkit-scrollbar-thumb:hover {
      background: #484f58;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #3b82f6;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 10000;
      font-size: 14px;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideOut {
      from { opacity: 1; transform: translateX(0); }
      to { opacity: 0; transform: translateX(100%); }
    }

    /* Ripple Effect System */
    .btn,
    .font-control-btn,
    .theme-toggle,
    button {
      position: relative;
      overflow: hidden;
    }

    .ripple-effect {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      transform: scale(0);
      animation: ripple-animation 0.6s linear;
      pointer-events: none;
      z-index: 1;
    }

    @keyframes ripple-animation {
      0% {
        transform: scale(0);
        opacity: 0.8;
      }
      50% {
        opacity: 0.4;
      }
      100% {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* Light mode ripple adjustment */
    body.light-mode .ripple-effect {
      background: rgba(0, 0, 0, 0.2);
    }

    /* Visualization Section Styles */
    .visualization-section {
      background: #161b22;
      border-left: 1px solid #30363d;
      width: 400px;
      min-width: 350px;
      max-width: 500px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
    }

    body.light-mode .visualization-section {
      background: #f6f8fa;
      border-left-color: #d0d7de;
    }

    .viz-resize-handle {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 6px;
      background: transparent;
      cursor: ew-resize;
      z-index: 100;
      transition: background 0.2s ease;
    }

    .viz-resize-handle:hover {
      background: rgba(88, 166, 255, 0.3);
    }

    .viz-resize-handle::before {
      content: '';
      position: absolute;
      left: 2px;
      top: 50%;
      transform: translateY(-50%);
      width: 2px;
      height: 40px;
      background: #30363d;
      border-radius: 1px;
    }

    .viz-resize-handle:hover::before {
      background: #58a6ff;
    }

    body.light-mode .viz-resize-handle::before {
      background: #d0d7de;
    }

    body.light-mode .viz-resize-handle:hover::before {
      background: #0969da;
    }

    .visualization-section {
      position: relative;
    }

    .viz-header {
      background: #21262d;
      padding: 12px 20px;
      border-bottom: 1px solid #30363d;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    body.light-mode .viz-header {
      background: #ffffff;
      border-bottom-color: #d0d7de;
    }

    .viz-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: #f0f6fc;
    }

    body.light-mode .viz-header h3 {
      color: #24292f;
    }

    .step-controls {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: space-between;
      min-height: 32px;
    }

    .step-buttons {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-wrap: wrap;
    }

    .step-controls .btn {
      padding: 4px 8px;
      font-size: 11px;
      height: 28px;
      min-width: auto;
      white-space: nowrap;
    }

    .step-counter {
      font-size: 12px;
      color: #8b949e;
      font-weight: 500;
      white-space: nowrap;
    }

    body.light-mode .step-counter {
      color: #656d76;
    }

    .viz-content {
      flex: 1;
      padding: 16px 20px;
      overflow-y: auto;
    }

    .viz-sections {
      display: flex;
      flex-direction: column;
      gap: 16px;
      height: 100%;
    }

    .variables-section, .call-stack-section {
      flex: 1;
      min-width: 0;
    }

    .variables-section h4, .call-stack-section h4 {
      margin: 0 0 12px 0;
      font-size: 14px;
      font-weight: 600;
      color: #58a6ff;
      background: rgba(88, 166, 255, 0.1);
      padding: 6px 12px;
      border-radius: 6px;
      border-left: 3px solid #58a6ff;
    }

    body.light-mode .variables-section h4, 
    body.light-mode .call-stack-section h4 {
      color: #0969da;
      background: rgba(9, 105, 218, 0.1);
      border-left-color: #0969da;
    }

    .variables-table, .call-stack-list {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      overflow: hidden;
    }

    body.light-mode .variables-table, 
    body.light-mode .call-stack-list {
      background: #ffffff;
      border-color: #d0d7de;
    }

    .variable-row {
      display: flex;
      padding: 8px 12px;
      border-bottom: 1px solid #21262d;
      align-items: center;
    }

    body.light-mode .variable-row {
      border-bottom-color: #d0d7de;
    }

    .variable-row:last-child {
      border-bottom: none;
    }

    .variable-name {
      font-weight: 600;
      color: #f85149;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      flex: 0 0 120px;
    }

    body.light-mode .variable-name {
      color: #cf222e;
    }

    .variable-value {
      color: #a5d6ff;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      flex: 1;
      word-break: break-word;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    body.light-mode .variable-value {
      color: #0969da;
    }

    .value-content {
      flex: 1;
    }

    .value-type {
      font-size: 11px;
      color: #8b949e;
      font-weight: 500;
      background: rgba(33, 38, 45, 0.6);
      padding: 2px 6px;
      border-radius: 3px;
      white-space: nowrap;
    }

    body.light-mode .value-type {
      color: #656d76;
      background: rgba(208, 215, 222, 0.6);
    }

    .stack-frame {
      padding: 8px 12px;
      border-bottom: 1px solid #21262d;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      color: #e6edf3;
    }

    body.light-mode .stack-frame {
      border-bottom-color: #d0d7de;
      color: #24292f;
    }

    .stack-frame:last-child {
      border-bottom: none;
    }

    .stack-frame.current {
      background: rgba(88, 166, 255, 0.15);
      color: #58a6ff;
      font-weight: 600;
    }

    body.light-mode .stack-frame.current {
      background: rgba(9, 105, 218, 0.1);
      color: #0969da;
    }

    .empty-state {
      padding: 24px;
      text-align: center;
      color: #8b949e;
      font-size: 13px;
      font-style: italic;
      background: rgba(33, 38, 45, 0.3);
      border: 1px dashed #30363d;
      border-radius: 6px;
      margin: 8px 0;
    }

    body.light-mode .empty-state {
      color: #656d76;
      background: rgba(208, 215, 222, 0.3);
      border-color: #d0d7de;
    }

    /* Line highlighting for visualization */
    .current-execution-line {
      background: rgba(88, 166, 255, 0.15) !important;
      border-left: 3px solid #58a6ff !important;
    }

    .current-execution-glyph {
      background: #58a6ff;
      width: 6px !important;
      border-radius: 3px;
      margin-left: 3px;
    }

    body.light-mode .current-execution-line {
      background: rgba(9, 105, 218, 0.1) !important;
      border-left-color: #0969da !important;
    }

    body.light-mode .current-execution-glyph {
      background: #0969da;
    }

    /* Responsive visualization */
    @media (max-width: 1200px) {
      .main-content {
        flex-direction: column;
      }
      
      .visualization-section {
        width: 100%;
        min-width: auto;
        max-width: none;
        border-left: none;
        border-top: 1px solid #30363d;
        height: 300px;
        max-height: 40vh;
      }

      body.light-mode .visualization-section {
        border-top-color: #d0d7de;
      }
      
      .viz-sections {
        flex-direction: row;
        gap: 24px;
      }
      
      .variables-section, .call-stack-section {
        flex: 1;
      }
    }

    @media (max-width: 768px) {
      .viz-sections {
        flex-direction: column;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="fullscreen-container">
    <!-- Header -->
    <div class="header">
      <h1>Python Editor</h1>
      <div class="header-buttons">
        <div class="program-controls">
          <button class="btn btn-primary" onclick="runCode()">Run Code</button>
          <button class="btn btn-primary" onclick="visualizeCode()">Visualize Code</button>
          <button class="btn btn-primary" onclick="downloadCode()">Download</button>
          <button class="btn btn-neutral" onclick="clearOutput()">Clear Output</button>
          <button class="btn btn-warning" onclick="resetCode()">Reset</button>
        </div>
        <div class="settings-controls">
        <div class="font-controls">
          <div class="editor-font-controls">
            <span class="font-label">Editor:</span>
            <button class="font-control-btn" onclick="decreaseEditorFontSize()" title="Decrease editor font size">A-</button>
            <span class="font-size-display" id="editor-font-size-display">16px</span>
            <button class="font-control-btn" onclick="increaseEditorFontSize()" title="Increase editor font size">A+</button>
          </div>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">
            <span id="theme-text">Light Mode</span>
        </button>
        <button class="btn btn-danger" onclick="closeFullscreen()">Close</button>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
      <!-- Left Side: Editor and Output -->
      <div class="editor-main">
        <div class="editor-wrapper">
          <div id="monaco-editor"></div>
        </div>
        

        <!-- Output Section -->
        <div class="output-section" id="output-section">
          <div class="resize-handle" id="resize-handle"></div>
          <div class="output-header">
            <span>Output Console</span>
            <div class="output-font-controls">
              <button class="font-control-btn" onclick="decreaseOutputFontSize()" title="Decrease output font size">A-</button>
              <span class="font-size-display" id="output-font-size-display">13px</span>
              <button class="font-control-btn" onclick="increaseOutputFontSize()" title="Increase output font size">A+</button>
            </div>
          </div>
          <div class="output-content" id="output">Write some Python code and click "Run Code" to see results...</div>
        </div>
      </div>

      <!-- Right Side: Visualization Panel -->
      <div class="visualization-section" id="visualization-section" style="display: none;">
        <div class="viz-resize-handle" id="viz-resize-handle"></div>
        <div class="viz-header">
          <h3>Code Visualization</h3>
          <div class="step-controls">
            <span class="step-counter">Step <span id="current-step">0</span> of <span id="total-steps">0</span></span>
            <div class="step-buttons">
              <button class="btn btn-secondary" id="prev-step" onclick="prevStep()" disabled>← Prev</button>
              <button class="btn btn-secondary" id="next-step" onclick="nextStep()" disabled>Next →</button>
              <button class="btn btn-warning" id="cancel-viz" onclick="cancelVisualization()">Cancel</button>
              <button class="btn btn-neutral" id="reset-viz" onclick="resetVisualization()">Reset</button>
            </div>
          </div>
        </div>
        <div class="viz-content">
          <div class="viz-sections">
            <div class="variables-section">
              <h4>📊 Variables</h4>
              <div id="variables-display" class="variables-table"></div>
            </div>
            <div class="call-stack-section">
              <h4>📋 Call Stack</h4>
              <div id="call-stack-display" class="call-stack-list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let editor = null;
    let isResizing = false;
    let startY = 0;
    let startHeight = 0;
    let editorFontSize = 16;
    let outputFontSize = 13;
    let isLightMode = false;
    
    // Load Monaco Editor and Skulpt
    function loadMonaco() {
      return new Promise((resolve) => {
        if (window.require && window.monaco) {
          resolve();
          return;
        }
        
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js';
        script.onload = () => {
          setTimeout(resolve, 100);
        };
        document.head.appendChild(script);
      });
    }
    
    function loadSkulpt() {
      return new Promise((resolve, reject) => {
        if (window.Sk) {
          resolve();
          return;
        }
        
        const skulptScript = document.createElement('script');
        skulptScript.src = 'https://skulpt.org/js/skulpt.min.js';
        skulptScript.onload = () => {
          const skulptStdlib = document.createElement('script');
          skulptStdlib.src = 'https://skulpt.org/js/skulpt-stdlib.js';
          skulptStdlib.onload = () => {
            console.log('Skulpt loaded successfully!');
            resolve();
          };
          skulptStdlib.onerror = () => reject(new Error('Failed to load Skulpt stdlib'));
          document.head.appendChild(skulptStdlib);
        };
        skulptScript.onerror = () => reject(new Error('Failed to load Skulpt'));
        document.head.appendChild(skulptScript);
      });
    }

    const defaultPythonCode = `print("Hello World")`;

    async function initializeEditor() {
      try {
        await loadMonaco();
        loadSkulpt().catch(error => console.warn('Skulpt failed to load:', error));
        
        if (!window.require) {
          console.error('Monaco loader not available');
          return;
        }
        
        window.require.config({ 
          paths: { 
            'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' 
          } 
        });
        
        window.require(['vs/editor/editor.main'], function () {
          const editorElement = document.getElementById('monaco-editor');
          if (!editorElement) {
            console.error('Monaco editor container not found');
            return;
          }
          
          let initialCode = defaultPythonCode;
          
          editor = monaco.editor.create(editorElement, {
            value: initialCode,
            language: 'python',
            theme: 'vs-dark',
            fontSize: editorFontSize,
            lineNumbers: 'on',
            roundedSelection: false,
            scrollBeyondLastLine: false,
            readOnly: false,
            automaticLayout: true,
            minimap: { enabled: true },
            folding: true,
            lineNumbersMinChars: 3,
            wordWrap: 'on',
            scrollbar: {
              verticalScrollbarSize: 10,
              horizontalScrollbarSize: 10
            }
          });
          
          // Update font size displays and output font size
          updateEditorFontSizeDisplay();
          updateOutputFontSizeDisplay();
          updateOutputFontSize();
          
          console.log('Fullscreen Monaco Editor initialized!');
        });
      } catch (error) {
        console.error('Failed to initialize Monaco:', error);
      }
    }

    // Editor functions
    function runCode() {
      const output = document.getElementById('output');
      
      if (!editor) {
        output.textContent = 'Error: Editor not initialized. Please wait for the editor to load.';
        showNotification('Editor not ready yet');
        return;
      }
      
      try {
        const code = editor.getValue();
        output.textContent = `Running Python code...\\n\\n`;
        
        setTimeout(() => {
          executePython(code, output);
        }, 300);
      } catch (error) {
        output.textContent = `Error: ${error.message}`;
        showNotification('Error running code');
      }
    }

    async function executePython(code, output) {
      try {
        if (!window.Sk) {
          output.textContent = 'Loading Python interpreter...\\n\\n';
          await loadSkulpt();
        }
        
        let pythonOutput = '';
        
        Sk.pre = "output";
        Sk.configure({
          output: function(text) {
            pythonOutput += text;
          },
          read: function(x) {
            if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined) {
              throw "File not found: '" + x + "'";
            }
            return Sk.builtinFiles["files"][x];
          },
          __future__: Sk.python3,
          python3: true
        });
        
        output.textContent = 'Running Python code...\\n\\n';
        
        const promise = Sk.misceval.asyncToPromise(() => {
          return Sk.importMainWithBody("<stdin>", false, code, true);
        });
        
        await promise;
        
        if (pythonOutput.trim()) {
          output.textContent = pythonOutput;
        } else {
          output.textContent = 'No output produced. Try adding print() statements.';
        }
        
        showNotification('Code executed');
        
      } catch (error) {
        let errorMessage = error.toString();
        
        if (error.traceback) {
          const lineInfo = error.traceback[0];
          if (lineInfo && lineInfo.lineno) {
            errorMessage = `Line ${lineInfo.lineno}: ${error.args ? error.args.v[0].v : errorMessage}`;
          }
        }
        
        output.textContent = `Python Error:\n${errorMessage}\n\nCheck your Python syntax and try again.\nUsing Skulpt Python interpreter.`;
        showNotification('Python execution error');
      }
    }

    function downloadCode() {
      if (!editor) {
        showNotification('Editor not ready yet');
        return;
      }
      
      try {
        const code = editor.getValue();
        const blob = new Blob([code], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = 'exercise.py';
        link.style.display = 'none';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        window.URL.revokeObjectURL(url);
        showNotification('Python file downloaded as exercise.py');
      } catch (error) {
        showNotification('Error downloading file');
        console.error('Download error:', error);
      }
    }


    function clearOutput() {
      const output = document.getElementById('output');
      output.textContent = 'Output cleared. Write some Python code and click "Run Code" to see results...';
      showNotification('Output cleared');
    }

    function resetCode() {
      if (!editor) {
        showNotification('Editor not ready yet');
        return;
      }
      
      try {
        editor.setValue(defaultPythonCode);
        document.getElementById('output').textContent = 'Code reset to default template. Ready to run!';
        showNotification('Code reset to default template');
      } catch (error) {
        showNotification('Error resetting code');
      }
    }

    // Visualization state
    let visualizationState = {
      steps: [],
      currentStep: -1,
      isVisualizationMode: false,
      inputQueue: [],
      waitingForInput: false
    };

    function visualizeCode() {
      if (!editor) {
        showNotification('Editor not ready yet');
        return;
      }
      
      try {
        const code = editor.getValue();
        const output = document.getElementById('output');
        output.textContent = 'Starting code visualization...';
        
        // Disable run buttons during visualization
        setRunButtonsDisabled(true);
        
        // Show visualization panel
        const vizSection = document.getElementById('visualization-section');
        if (!vizSection) {
          console.error('Visualization section not found!');
          showNotification('Visualization panel not found');
          setRunButtonsDisabled(false);
          return;
        }
        
        console.log('Showing visualization panel...');
        vizSection.style.display = 'flex';
        
        // Start visualization
        executeCodeVisualization(code);
        
      } catch (error) {
        showNotification('Error starting visualization');
        console.error('Visualization error:', error);
        setRunButtonsDisabled(false);
      }
    }

    function setRunButtonsDisabled(disabled) {
      // Disable all run code buttons
      const runButtons = document.querySelectorAll('button[onclick="runCode()"]');
      runButtons.forEach(btn => {
        btn.disabled = disabled;
        if (disabled) {
          btn.style.opacity = '0.5';
          btn.style.cursor = 'not-allowed';
        } else {
          btn.style.opacity = '';
          btn.style.cursor = '';
        }
      });
    }

    async function executeCodeVisualization(code) {
      try {
        if (!window.Sk) {
          await loadSkulpt();
        }
        
        // Reset visualization state
        visualizationState = {
          steps: [],
          currentStep: -1,
          isVisualizationMode: true,
          inputQueue: [],
          waitingForInput: false
        };
        
        // Create initial step
        let executionSteps = [{
          line: 0,
          variables: {},
          callStack: ['<module>'],
          output: '',
          description: 'Program started',
          waitingForInput: false
        }];
        
        // Simulate execution with input handling
        simulateExecution(code, executionSteps);
        
        visualizationState.steps = executionSteps;
        visualizationState.currentStep = 0;
        
        updateVisualizationDisplay();
        updateStepControls();
        
        showNotification(`Code visualization ready! ${executionSteps.length} steps created.`);
        
      } catch (error) {
        console.error('Visualization execution error:', error);
        showNotification('Error during code visualization');
        
        const output = document.getElementById('output');
        output.textContent = `Visualization Error: ${error.message}`;
      }
    }
    
    // Function to evaluate expressions with variables
    function evaluateExpression(expression, variables) {
      // Remove whitespace
      expression = expression.trim();
      
      // Handle string literals
      if ((expression.startsWith('"') && expression.endsWith('"')) || 
          (expression.startsWith("'") && expression.endsWith("'"))) {
        return expression;
      }
      
      // Handle boolean literals
      if (expression === 'True' || expression === 'False') {
        return expression;
      }
      
      // Handle numeric literals
      if (!isNaN(parseFloat(expression)) && isFinite(expression)) {
        return expression;
      }
      
      // Handle variable references
      if (variables[expression]) {
        return variables[expression];
      }
      
      // Handle simple arithmetic expressions
      try {
        // Replace variable names with their values
        let evaluatedExpr = expression;
        
        // Sort variable names by length (longest first) to avoid partial replacements
        const sortedVars = Object.keys(variables).sort((a, b) => b.length - a.length);
        
        for (const varName of sortedVars) {
          const varValue = variables[varName];
          // Remove quotes from string values for arithmetic
          const numericValue = parseFloat(varValue.replace(/['"]/g, ''));
          
          if (!isNaN(numericValue)) {
            // Replace whole word only (use word boundaries)
            const regex = new RegExp(`\\b${varName}\\b`, 'g');
            evaluatedExpr = evaluatedExpr.replace(regex, numericValue.toString());
          }
        }
        
        // Evaluate simple arithmetic expressions safely
        // Only allow numbers, operators, parentheses, and whitespace
        if (/^[\d\s+\-*/().]+$/.test(evaluatedExpr)) {
          const result = Function('"use strict"; return (' + evaluatedExpr + ')')();
          return result.toString();
        }
      } catch (error) {
        console.warn('Error evaluating expression:', expression, error);
      }
      
      // If we can't evaluate, return the original expression
      return expression;
    }

    function simulateExecution(code, steps) {
      const allLines = code.split('\n');
      let variables = {};
      let lineNum = 0;
      
      for (let i = 0; i < allLines.length && steps.length < 30; i++) {
        const line = allLines[i];
        lineNum = i + 1;
        
        // Skip empty lines and comments
        if (!line.trim() || line.trim().startsWith('#')) {
          continue;
        }
        
        const trimmedLine = line.trim();
        let output = '';
        let waitingForInput = false;
        
        // Handle input() statements - this pauses execution
        if (trimmedLine.includes('input(')) {
          waitingForInput = true;
          let inputMatch = trimmedLine.match(/(\w+)\s*=\s*input\((.*)\)/);
          if (inputMatch) {
            const varName = inputMatch[1];
            const prompt = inputMatch[2];
            output = `Input prompt: ${prompt}\n`;
            // Simulate user input
            variables[varName] = '"User Input"';
          }
        }
        // Variable assignment
        else if (trimmedLine.includes('=') && !trimmedLine.includes('==') && !trimmedLine.includes('!=') && !trimmedLine.includes('>=') && !trimmedLine.includes('<=')) {
          const parts = trimmedLine.split('=');
          if (parts.length === 2) {
            const varName = parts[0].trim();
            let value = parts[1].trim();
            
            // Evaluate the expression
            const evaluatedValue = evaluateExpression(value, variables);
            variables[varName] = evaluatedValue;
          }
        }
        // Handle print statements
        else if (trimmedLine.includes('print(')) {
          let printContent = trimmedLine.match(/print\((.*)\)/);
          if (printContent) {
            let content = printContent[1];
            if (content.startsWith('f"') || content.startsWith("f'")) {
              // Handle f-strings - simple variable substitution
              let fstring = content.slice(2, -1);
              // Replace {variable} with actual values
              fstring = fstring.replace(/\{(\w+)\}/g, (match, varName) => {
                if (variables[varName]) {
                  return variables[varName].replace(/['"]/g, ''); // Remove quotes for display
                }
                return match;
              });
              output = `${fstring}\n`;
            } else if (content.startsWith('"') && content.endsWith('"')) {
              output = `${content.slice(1, -1)}\n`;
            } else if (content.startsWith("'") && content.endsWith("'")) {
              output = `${content.slice(1, -1)}\n`;
            } else {
              output = `${content}\n`;
            }
          }
        }
        
        steps.push({
          line: lineNum,
          variables: {...variables},
          callStack: ['<module>'],
          output: output,
          description: `Line ${lineNum}: ${trimmedLine}`,
          waitingForInput: waitingForInput
        });
      }
    }
    
    function updateVisualizationDisplay() {
      if (visualizationState.currentStep < 0 || visualizationState.currentStep >= visualizationState.steps.length) {
        return;
      }
      
      const currentStepData = visualizationState.steps[visualizationState.currentStep];
      
      // Update variables display
      updateVariablesDisplay(currentStepData.variables);
      
      // Update call stack display
      updateCallStackDisplay(currentStepData.callStack);
      
      // Highlight current line in editor
      highlightCurrentLine(currentStepData.line);
      
      // Update output
      const output = document.getElementById('output');
      const allOutput = visualizationState.steps
        .slice(0, visualizationState.currentStep + 1)
        .map(step => step.output)
        .join('');
      
      if (currentStepData.waitingForInput) {
        output.textContent = allOutput + '\n[VISUALIZATION: Program waiting for input - click Next to continue]';
      } else {
        output.textContent = allOutput || 'No output yet...';
      }
    }
    
    function updateVariablesDisplay(variables) {
      const container = document.getElementById('variables-display');
      
      if (!container) return;
      
      if (Object.keys(variables).length === 0) {
        container.innerHTML = '<div class="empty-state">No variables yet</div>';
        return;
      }
      
      container.innerHTML = '';
      for (const [name, value] of Object.entries(variables)) {
        const row = document.createElement('div');
        row.className = 'variable-row';
        
        // Format the value display
        let displayValue = value;
        let valueType = '';
        
        if (value.startsWith('"') && value.endsWith('"')) {
          valueType = 'str';
          displayValue = value; // Keep quotes for strings
        } else if (value.startsWith("'") && value.endsWith("'")) {
          valueType = 'str';
          displayValue = value; // Keep quotes for strings
        } else if (value === 'True' || value === 'False') {
          valueType = 'bool';
          displayValue = value;
        } else if (!isNaN(parseFloat(value)) && isFinite(value)) {
          if (value.includes('.')) {
            valueType = 'float';
          } else {
            valueType = 'int';
          }
          displayValue = value;
        } else {
          valueType = 'unknown';
          displayValue = value;
        }
        
        row.innerHTML = `
          <div class="variable-name">${name}</div>
          <div class="variable-value">
            <span class="value-content">${displayValue}</span>
            <span class="value-type">(${valueType})</span>
          </div>
        `;
        container.appendChild(row);
      }
    }
    
    function updateCallStackDisplay(callStack) {
      const container = document.getElementById('call-stack-display');
      
      if (!container) return;
      
      if (callStack.length === 0) {
        container.innerHTML = '<div class="empty-state">No call stack</div>';
        return;
      }
      
      container.innerHTML = '';
      callStack.forEach((frame, index) => {
        const frameEl = document.createElement('div');
        frameEl.className = `stack-frame ${index === callStack.length - 1 ? 'current' : ''}`;
        frameEl.textContent = frame;
        container.appendChild(frameEl);
      });
    }
    
    function highlightCurrentLine(lineNumber) {
      if (!editor || lineNumber <= 0) return;
      
      // Clear existing decorations
      if (window.currentLineDecoration) {
        editor.deltaDecorations([window.currentLineDecoration], []);
      }
      
      // Add new line highlighting
      window.currentLineDecoration = editor.deltaDecorations([], [{
        range: new monaco.Range(lineNumber, 1, lineNumber, 1),
        options: {
          isWholeLine: true,
          className: 'current-execution-line',
          glyphMarginClassName: 'current-execution-glyph'
        }
      }])[0];
    }
    
    function nextStep() {
      if (visualizationState.currentStep < visualizationState.steps.length - 1) {
        visualizationState.currentStep++;
        updateVisualizationDisplay();
        updateStepControls();
      }
    }
    
    function prevStep() {
      if (visualizationState.currentStep > 0) {
        visualizationState.currentStep--;
        updateVisualizationDisplay();
        updateStepControls();
      }
    }
    
    function cancelVisualization() {
      // Re-enable run buttons
      setRunButtonsDisabled(false);
      
      // Hide visualization panel
      const vizSection = document.getElementById('visualization-section');
      vizSection.style.display = 'none';
      
      // Clear line highlighting
      if (window.currentLineDecoration && editor) {
        editor.deltaDecorations([window.currentLineDecoration], []);
        window.currentLineDecoration = null;
      }
      
      // Reset state
      visualizationState = {
        steps: [],
        currentStep: -1,
        isVisualizationMode: false,
        inputQueue: [],
        waitingForInput: false
      };
      
      // Clear output
      const output = document.getElementById('output');
      output.textContent = 'Visualization cancelled. Write some Python code and click "Run Code" to see results...';
      
      showNotification('Visualization cancelled');
    }

    function resetVisualization() {
      visualizationState.currentStep = 0;
      updateVisualizationDisplay();
      updateStepControls();
      
      // Hide visualization panel
      const vizSection = document.getElementById('visualization-section');
      vizSection.style.display = 'none';
      
      // Re-enable run buttons
      setRunButtonsDisabled(false);
      
      // Clear line highlighting
      if (window.currentLineDecoration && editor) {
        editor.deltaDecorations([window.currentLineDecoration], []);
        window.currentLineDecoration = null;
      }
      
      showNotification('Visualization reset');
    }
    
    function updateStepControls() {
      const currentStepEl = document.getElementById('current-step');
      const totalStepsEl = document.getElementById('total-steps');
      const prevBtn = document.getElementById('prev-step');
      const nextBtn = document.getElementById('next-step');
      
      if (!currentStepEl || !totalStepsEl || !prevBtn || !nextBtn) {
        return;
      }
      
      if (visualizationState.steps.length === 0) {
        currentStepEl.textContent = '0';
        totalStepsEl.textContent = '0';
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        return;
      }
      
      currentStepEl.textContent = visualizationState.currentStep + 1;
      totalStepsEl.textContent = visualizationState.steps.length;
      
      prevBtn.disabled = visualizationState.currentStep <= 0;
      nextBtn.disabled = visualizationState.currentStep >= visualizationState.steps.length - 1;
    }

    function closeFullscreen() {
      try {
        window.close();
      } catch (error) {
        window.close();
      }
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 300);
      }, 2500);
    }
    
    // Resize functionality
    function initializeResizeHandle() {
      const resizeHandle = document.getElementById('resize-handle');
      const outputSection = document.getElementById('output-section');
      
      if (!resizeHandle || !outputSection) return;
      
      resizeHandle.addEventListener('mousedown', (e) => {
        isResizing = true;
        startY = e.clientY;
        startHeight = parseInt(document.defaultView.getComputedStyle(outputSection).height, 10);
        document.body.classList.add('resizing');
        e.preventDefault();
      });
      
      document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;
        
        const deltaY = startY - e.clientY; // Reversed because we want to drag up to make bigger
        const newHeight = Math.max(100, Math.min(window.innerHeight * 0.7, startHeight + deltaY));
        
        outputSection.style.height = newHeight + 'px';
        
        // Trigger Monaco editor resize if needed
        if (editor) {
          setTimeout(() => {
            editor.layout();
          }, 0);
        }
        
        e.preventDefault();
      });
      
      document.addEventListener('mouseup', () => {
        if (isResizing) {
          isResizing = false;
          document.body.classList.remove('resizing');
        }
      });
    }

    // Editor font size controls
    function increaseEditorFontSize() {
      if (!editor) {
        showNotification('Editor not ready yet');
        return;
      }
      
      if (editorFontSize < 40) {
        editorFontSize += 2;
        editor.updateOptions({ fontSize: editorFontSize });
        updateEditorFontSizeDisplay();
        showNotification(`Editor font size increased to ${editorFontSize}px`);
      }
    }

    function decreaseEditorFontSize() {
      if (!editor) {
        showNotification('Editor not ready yet');
        return;
      }
      
      if (editorFontSize > 10) {
        editorFontSize -= 2;
        editor.updateOptions({ fontSize: editorFontSize });
        updateEditorFontSizeDisplay();
        showNotification(`Editor font size decreased to ${editorFontSize}px`);
      }
    }

    // Output font size controls
    function increaseOutputFontSize() {
      if (outputFontSize < 40) {
        outputFontSize += 2;
        updateOutputFontSize();
        updateOutputFontSizeDisplay();
        showNotification(`Output font size increased to ${outputFontSize}px`);
      }
    }

    function decreaseOutputFontSize() {
      if (outputFontSize > 10) {
        outputFontSize -= 2;
        updateOutputFontSize();
        updateOutputFontSizeDisplay();
        showNotification(`Output font size decreased to ${outputFontSize}px`);
      }
    }

    function updateOutputFontSize() {
      const outputContent = document.getElementById('output');
      if (outputContent) {
        outputContent.style.fontSize = `${outputFontSize}px`;
      }
      
      // Also update visualization elements font size
      const variablesTable = document.querySelector('.variables-table');
      const callStackList = document.querySelector('.call-stack-list');
      
      if (variablesTable) {
        const variableRows = variablesTable.querySelectorAll('.variable-name, .variable-value');
        variableRows.forEach(element => {
          element.style.fontSize = `${Math.max(11, outputFontSize - 2)}px`;
        });
      }
      
      if (callStackList) {
        const stackFrames = callStackList.querySelectorAll('.stack-frame');
        stackFrames.forEach(element => {
          element.style.fontSize = `${Math.max(11, outputFontSize - 2)}px`;
        });
      }
    }

    function updateEditorFontSizeDisplay() {
      const display = document.getElementById('editor-font-size-display');
      if (display) {
        display.textContent = `${editorFontSize}px`;
      }
    }

    function updateOutputFontSizeDisplay() {
      const display = document.getElementById('output-font-size-display');
      if (display) {
        display.textContent = `${outputFontSize}px`;
      }
    }

    // Theme toggle
    function toggleTheme() {
      if (!editor) {
        showNotification('Editor not ready yet');
        return;
      }
      
      isLightMode = !isLightMode;
      const body = document.body;
      const themeIcon = document.getElementById('theme-icon');
      const themeText = document.getElementById('theme-text');
      
      if (isLightMode) {
        body.classList.add('light-mode');
        editor.updateOptions({ theme: 'vs' });
        themeText.textContent = 'Dark Mode';
        showNotification('Switched to light mode');
      } else {
        body.classList.remove('light-mode');
        editor.updateOptions({ theme: 'vs-dark' });
        themeText.textContent = 'Light Mode';
        showNotification('Switched to dark mode');
      }
    }

    // Initialize when DOM is ready
    function init() {
      console.log('Initializing fullscreen Python editor...');
      setTimeout(() => {
        initializeEditor();
        initializeResizeHandle();
        initializeVizResizeHandle();
      }, 300);
    }

    // Visualization panel resize functionality
    function initializeVizResizeHandle() {
      const vizResizeHandle = document.getElementById('viz-resize-handle');
      const vizSection = document.getElementById('visualization-section');
      let isVizResizing = false;
      let startX = 0;
      let startWidth = 0;
      
      if (!vizResizeHandle || !vizSection) return;
      
      vizResizeHandle.addEventListener('mousedown', (e) => {
        isVizResizing = true;
        startX = e.clientX;
        startWidth = parseInt(document.defaultView.getComputedStyle(vizSection).width, 10);
        document.body.classList.add('resizing');
        e.preventDefault();
      });
      
      document.addEventListener('mousemove', (e) => {
        if (!isVizResizing) return;
        
        const deltaX = startX - e.clientX; // Reversed because we want to drag left to make bigger
        const newWidth = Math.max(300, Math.min(800, startWidth + deltaX));
        
        vizSection.style.width = newWidth + 'px';
        
        // Trigger Monaco editor resize if needed
        if (editor) {
          setTimeout(() => {
            editor.layout();
          }, 0);
        }
        
        e.preventDefault();
      });
      
      document.addEventListener('mouseup', () => {
        if (isVizResizing) {
          isVizResizing = false;
          document.body.classList.remove('resizing');
        }
      });
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    // Ripple Effect System for Fullscreen Editor
    function createRippleEffect(event) {
      const element = event.currentTarget;
      const rect = element.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = event.clientX - rect.left - size / 2;
      const y = event.clientY - rect.top - size / 2;
      
      const ripple = document.createElement('div');
      ripple.classList.add('ripple-effect');
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = x + 'px';
      ripple.style.top = y + 'px';
      
      // Remove any existing ripples to avoid accumulation
      const existingRipples = element.querySelectorAll('.ripple-effect');
      existingRipples.forEach(r => r.remove());
      
      element.appendChild(ripple);
      
      // Remove ripple after animation completes
      setTimeout(() => {
        if (ripple.parentNode) {
          ripple.remove();
        }
      }, 600);
    }

    function initRippleEffects() {
      const clickableSelectors = [
        '.btn', '.font-control-btn', '.theme-toggle', 'button:not(.no-ripple)'
      ];
      
      clickableSelectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(element => {
          if (!element.hasAttribute('data-ripple-attached')) {
            element.setAttribute('data-ripple-attached', 'true');
            element.addEventListener('click', createRippleEffect);
          }
        });
      });
    }

    // Initialize ripple effects after DOM is ready
    setTimeout(() => {
      initRippleEffects();
      console.log('Ripple effects initialized for fullscreen editor');
    }, 1000);
  </script>
</body>
</html>